unlzma outer container
go to offset of xz compressed cpio
decompress that
cpio copy out to a directory
edit scripts/files as needed
use cpio to re-create archives using the -H newc format
edit the filenames as needed (pad the header + filename with nulls to a multiple of 4)
edit the file lengths as needed (add nulls after end of file)
re xz the cpio archive
write that into the outer container at the same offset
re-lzma that outer container
get the crc32 of that data, write it into the uboot image header at the data crc field (big endian)
replace the len_image field with the new length (big endian)
zero out the 4 bytes of the header crc field
get the crc32 of the 0x40 header bytes, and write that into the header crc field (big endian)